(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[17],{"079e5":function(e,t,s){},"2e7e":function(e,t,s){"use strict";s("079e5")},a472:function(e,t,s){e.exports=s.p+"img/ezcare.png"},ab55:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",[s("chat-header",{attrs:{online:e.online}}),s("q-dialog",{attrs:{seamless:"",position:"bottom","full-width":""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[s("q-card",[s("q-card-section",[s("div",{staticClass:"q-py-md q-ml-lg"},[s("q-rating",{attrs:{size:"3.5em",color:"green-5",icon:"star_border"},model:{value:e.rating,callback:function(t){e.rating=t},expression:"rating"}})],1),s("div",{staticClass:"q-py-md"},[s("q-btn",{staticClass:"full-width",attrs:{color:"primary",label:"Delete"},on:{click:e.deleteMessage}})],1),s("div",{staticClass:"q-py-md"},[s("q-btn",{staticClass:"full-width",attrs:{color:"primary",label:"Cancel"},on:{click:function(t){e.dialog=!1}}})],1)])],1)],1),s("div",{staticClass:"q-pa-md row justify-center"},[s("div",{staticStyle:{width:"100%","max-width":"400px"}},[e._l(e.messages,(function(t){return s("div",{key:t.id,staticClass:"row"},[s("div",{staticClass:"col-11"},[0===t.type?s("q-chat-message",{directives:[{name:"touch-hold",rawName:"v-touch-hold.mouse",value:e.handleHold,expression:"handleHold",modifiers:{mouse:!0}}],staticClass:"burmese",attrs:{text:[t.message],sent:t.sender_id!=e.sender_id,stamp:e.moment(t.created_at).format("D-M H:M"),"bg-color":t.sender_id!=e.sender_id?"blue-grey-6":"red-4","text-color":t.sender_id!=e.sender_id?"white":"black"}}):e._e(),1===t.type?s("q-chat-message",{directives:[{name:"touch-hold",rawName:"v-touch-hold.mouse",value:e.handleHold,expression:"handleHold",modifiers:{mouse:!0}}],attrs:{sent:t.sender_id!=e.sender_id,stamp:e.moment(t.created_at).format("D-M H:M"),"bg-color":t.sender_id!=e.sender_id?"blue-grey-6":"red-4","text-color":t.sender_id!=e.sender_id?"white":"black"}},[s("figure",[s("q-zoom",{attrs:{"background-color":"blue-grey-1","restore-on-scroll":""}},[s("img",{staticClass:"my-image",attrs:{src:e.getFile(t.message),width:"200px"}})])],1)]):e._e(),2===t.type?s("q-chat-message",{directives:[{name:"touch-hold",rawName:"v-touch-hold.mouse",value:e.handleHold,expression:"handleHold",modifiers:{mouse:!0}}],attrs:{sent:t.send_id!=e.sender_id,stamp:e.moment(t.created_at).format("D-M H:M"),"bg-color":t.sender_id!=e.sender_id?"blue-grey-6":"red-4","text-color":t.sender_id!=e.sender_id?"white":"black"}},[s("video",{attrs:{controls:"",width:"200px",src:e.getFile(t.message)}})]):e._e(),3===t.type?s("q-chat-message",{directives:[{name:"touch-hold",rawName:"v-touch-hold.mouse",value:e.handleHold,expression:"handleHold",modifiers:{mouse:!0}}],attrs:{sent:t.sender_id!=e.sender_id,stamp:e.moment(t.created_at).format("D-M H:M"),"bg-color":t.sender_id!=e.sender_id?"blue-grey-6":"red-4","text-color":t.sender_id!=e.sender_id?"white":"black"}},[s("audio",{staticStyle:{width:"200px"},attrs:{controls:"",src:e.getFile(t.message)}})]):e._e()],1),e.dialog?s("div",{staticClass:"col-1"},[t.sender_id!=e.sender_id?s("q-checkbox",{attrs:{val:t.id,color:"red"},model:{value:e.selection,callback:function(t){e.selection=t},expression:"selection"}}):e._e()],1):e._e()])})),s("div",{staticClass:"q-py-sm"}),s("div",{staticClass:"row justify-center items-center q-py-xs",class:{"absolute-bottom":e.messages.length<6},attrs:{id:"chat-input"}},[s("div",{staticClass:"col-1"},[s("q-icon",{attrs:{name:"mic",size:"sm",color:"red"},on:{click:function(t){return e.record()}}})],1),s("div",{staticClass:"col-2"},[s("q-file",{attrs:{borderless:"",dense:""},scopedSlots:e._u([{key:"before",fn:function(){return[s("q-icon",{attrs:{name:"attach_file"},on:{click:function(e){e.stopPropagation()}}})]},proxy:!0}]),model:{value:e.file,callback:function(t){e.file=t},expression:"file"}})],1),s("div",{staticClass:" col-7"},[s("q-input",{ref:"message",attrs:{borderless:"",label:"Messages",maxlength:"1500",dense:"dense",autogrow:"",readonly:!!e.file},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onEnter(t)}},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}})],1),s("div",{staticClass:"col-1"},[e.sending?s("q-icon",{attrs:{name:"send",size:"sm"}}):s("q-icon",{attrs:{name:"send",size:"sm"},on:{click:e.send}})],1)])],2)]),e.btnStop?s("q-page-sticky",{staticStyle:{"z-index":"10000"},attrs:{position:"bottom-right",offset:[15,18]}},[s("q-btn",{attrs:{fab:"",icon:"delete",color:"primary"},on:{click:function(t){return e.cancelRecord()}}}),s("q-btn",{attrs:{fab:"",icon:"stop",color:"negative"},on:{click:function(t){return e.stop()}}})],1):e._e()],1)},i=[],o=s("4082"),r=s.n(o),n=s("ded3"),d=s.n(n),l=(s("ddb0"),s("2f62")),c=s("cafa"),h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-header",{staticClass:"bg-red text-white",attrs:{elevated:"",reveal:""}},[a("q-toolbar",[a("div",{staticClass:"col-1"},["/"!==e.$route.fullPath?a("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",round:"",dense:"",icon:"west"},on:{click:function(t){return e.$router.go(-1)}}}):e._e()],1),a("div",{staticClass:"col-10"})]),a("q-toolbar",{staticClass:"q-pa-xs",attrs:{inset:""}},[a("div",{staticClass:"col-2 offset-1"},[1==e.user.status?a("q-avatar",{attrs:{size:"72px"}},[e.online?a("q-badge",{attrs:{rounded:"",floating:"",color:"green","text-color":"green",label:"1"}}):a("q-badge",{attrs:{rounded:"",floating:"",color:"black","text-color":"black",label:"0"}}),e.user.profile_image?a("img",{attrs:{src:e.getFile(e.user.profile_image.profile_picture)}}):a("img",{attrs:{src:s("a472")}})],1):e._e(),2==e.user.status?a("q-avatar",{attrs:{size:"72px"}},[e.online?a("q-badge",{attrs:{rounded:"",floating:"",color:"green","text-color":"green",label:"1"}}):a("q-badge",{attrs:{rounded:"",floating:"",color:"black","text-color":"black",label:"0"}}),e.user.profile_image?a("img",{attrs:{src:e.getFile(e.user.profile_image)}}):a("img",{attrs:{src:s("a472")}})],1):e._e()],1),a("div",{staticClass:"col-8 offset-1"},[e.user.hide_my_info?a("div",{staticClass:"text-h5"},[e._v("EZCare Doctor "+e._s(new Intl.NumberFormat("en",{minimumIntegerDigits:3,minimumSignificantDigits:1,useGrouping:!1}).format(e.user.id)))]):a("div",{staticClass:"text-h5"},[e._v(e._s(e.user.name))]),1==e.user.status?a("div",[a("div",{staticClass:"text-h6"},[e._v(e._s(e.user.qualifications))]),a("div",{staticClass:"text-h6"},[e._v(e._s(e.user.specialization))])]):e._e(),2==e.user.status?a("div",[a("div",{staticClass:"text-h6"},[e._v(e._s(e.user.age))]),a("div",{staticClass:"text-h6"},[e._v(e._s(e.user.gender))])]):e._e()])])],1)},u=[],g={props:["online"],data(){return{user:this.$route.params.user}},methods:{getFile(e){return`${c["a"].SERVER_MEDIA}${e}`}}},p=g,m=s("2877"),f=s("e359"),_=s("65c6"),b=s("9c40"),v=s("6ac5"),y=s("cb32"),x=s("58a81"),w=s("eebe"),k=s.n(w),q=Object(m["a"])(p,h,u,!1,null,null,null),C=q.exports;k()(q,"components",{QHeader:f["a"],QToolbar:_["a"],QBtn:b["a"],QToolbarTitle:v["a"],QAvatar:y["a"],QBadge:x["a"]});var $=s("782e"),D=s.n($),M=s("a154"),E={name:"Chat",components:{ChatHeader:C},data(){return{text:"",file:"",messages:[],online:"",type:0,sending:!1,dialog:!1,sender_id:this.$route.params.user_id,selection:[],mediaRecorder:null,chunks:[],btnStop:!1,record_cancel:!1,rating:0}},computed:d()({},Object(l["b"])({getDoctorProfile:"doctor/getDoctorProfile",getDoctorToken:"doctor/getDoctorToken"})),async created(){this.getDoctorProfile.app_user_id||await this.$store.dispatch("doctor/profile"),await this.subscribe(),this.init(),window.scrollTo(0,document.body.scrollHeight||document.documentElement.scrollHeight),this.$api.defaults.headers.Authorization=`Bearer ${this.getDoctorToken}`,this.$api.post("doctor_rated",{doctor_id:this.sender_id}).then((e=>{console.log(e.data.rating),this.sender_id===e.data.doctor_id&&(this.rating=e.data.rating)}))},watch:{rating:function(e){this.$api.post("doctor_rating",{doctor_id:this.sender_id,rating:e}).then((e=>{console.log(e)}))}},methods:{getFile(e){return`${c["a"].SERVER_MEDIA}${e}`},async getMessages(){this.$api.defaults.headers.Authorization=`Bearer ${this.getDoctorToken}`,await this.$api.post("messages",{sender_id:this.sender_id}).then((e=>{this.online=e.data.online_status,this.messages=e.data.data}))},async subscribe(){const e=this;var t=new D.a("836d77ac3f3198d7cf6d",{cluster:"ap1",forceTLS:!0}),s=t.subscribe("newMessage-"+this.sender_id+"-"+this.getDoctorProfile.app_user_id);s.bind("App\\Events\\MessageSent",(function(t){e.messages.push(t.message),e.$api.defaults.headers.Authorization=`Bearer ${this.getDoctorToken}`,e.$api.post("message_receive",{sender_id:this.sender_id}).then((e=>{this.messages=e.data.data}))}));var a=t.subscribe("online-"+this.sender_id);a.bind("App\\Events\\UserOnline",(function(t){e.online=1})),a.bind("App\\Events\\UserOffline",(function(t){e.online=2})),await this.getMessages()},async sendMessage(){""!==this.text&&(this.$api.defaults.headers.Authorization=`Bearer ${this.getDoctorToken}`,await this.$api.post("messages/send",{receiver_id:this.sender_id,message:this.text,type:this.type}).then((e=>{this.messages.push(e.data),this.text="",this.type=0,this.sending=!1})),window.scrollTo(0,document.body.scrollHeight||document.documentElement.scrollHeight),this.$refs.message.focus())},send(){if(this.sending=!0,""!==this.file){const e=new FormData;e.append("file",this.file),this.$api.defaults.headers.Authorization=`Bearer ${this.getDoctorToken}`,this.$api.post("file_upload",e,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{"0"===e.data.error_code&&("image"===this.file.type.split("/")[0]&&(this.type=1),"video"===this.file.type.split("/")[0]&&(this.type=2),this.text=e.data.file,this.file="",this.sendMessage())}))}else 0===this.type&&(this.text=this.text.replaceAll("\n","<br />")),this.sendMessage()},handleHold(e){let{evt:t}=e,s=r()(e,["evt"]);this.dialog=s.touch},async deleteMessage(){if(this.selection.length){const e=new FormData;for(const t of this.selection)e.append("message_id[]",t);this.$api.defaults.headers.Authorization=`Bearer ${this.getDoctorToken}`,await this.$api.post("chat_delete_single_conversation",e).then((e=>{console.log(e),"0"===e.data.error_code&&(this.selection=[],this.dialog=!1,this.getMessages())}))}},init(){navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{this.mediaRecorder=new MediaRecorder(e),this.mediaRecorder.ondataavailable=e=>{this.chunks.push(e.data)},this.mediaRecorder.onstop=e=>{if(!this.record_cancel){const e=new Blob(this.chunks,{type:"audio/ogg; codecs=opus"}),t=new FormData;t.append("file",e),this.$api.defaults.headers.Authorization=`Bearer ${this.getDoctorToken}`,this.$api.post("file_upload",t,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{"0"===e.data.error_code&&(this.file="",this.text=e.data.file,this.type=3)}))}}})).catch((function(e){console.log("The following getUserMedia error occured: "+e)})):alert("getUserMedia not supported on your browser!")},record(){this.mediaRecorder.start(),this.$q.loading.show({spinner:M["a"],spinnerColor:"white",backgroundColor:"primary"}),this.btnStop=!0},stop(){this.record_cancel=!1,this.mediaRecorder.stop(),this.$q.loading.hide(),this.btnStop=!1},cancelRecord(){this.record_cancel=!0,this.mediaRecorder.stop(),this.$q.loading.hide(),this.btnStop=!1}}},H=E,T=(s("2e7e"),s("9989")),Q=s("24e8"),R=s("f09f"),S=s("a370"),z=s("daf4"),A=s("8169"),F=s("8f8e"),B=s("0016"),P=s("7d53"),I=s("27f9"),O=s("de5e"),N=s("f449"),U=Object(m["a"])(H,a,i,!1,null,"09ffeedc",null);t["default"]=U.exports;k()(U,"components",{QPage:T["a"],QDialog:Q["a"],QCard:R["a"],QCardSection:S["a"],QRating:z["a"],QBtn:b["a"],QChatMessage:A["a"],QCheckbox:F["a"],QIcon:B["a"],QFile:P["a"],QInput:I["a"],QPageSticky:O["a"]}),k()(U,"directives",{TouchHold:N["a"]})},cafa:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));const a={APP_VERSION:"0.1",SERVER_MEDIA:"http://188.166.217.32/"}}}]);